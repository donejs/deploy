#!/usr/bin/env node
var fsx = require("fs-extra"),
	error = require("../lib/error"),
	bundle = require("../lib/package").package,
	services = require("../lib/services");

var packageJSON = fsx.readJsonSync(process.cwd() + "/package.json");
if (!packageJSON || !packageJSON.donejs || !packageJSON.donejs.deploy) {
	error("the donejs section of package.json requires a 'deploy' property");
}

var deploy = packageJSON.donejs.deploy;
if (!deploy.services) {
	error("donejs.deploy section of package.json requires a 'services' property");
}

var deployName = (process.argv.length > 2) ? process.argv[2] : null;
selected = services.selected(deployName, deploy.services, services.list(), error);
if (!selected) {
	error("the service you specified is not available");
}

console.log("donejs - deploying to '" + selected.config.type + "'");

var files = bundle(deploy, error);
selected.service.deploy(selected.config, files, error);
