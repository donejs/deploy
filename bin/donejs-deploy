#!/usr/bin/env node
var package = require("../lib/package").package,
	services = require("../lib/services");

try {
	var packageJSON = fsx.readJsonSync(packpath.self() + "/package.json");
	var donejsDeploy = {};
	if (packageJSON && packageJSON.donejs && packageJSON.donejs.deploy) {
		donejsDeploy = packageJSON.donejs.deploy;
	}
	package(donejsDeploy);

	var selectedService = null;
	services.serviceList().forEach(function(service) {
		if (service.name === options.service.toLowerCase()) {
			selectedService = service;
		}
	});
	if (!selectedService) {
		throw new Error("the service you specified is not available");
	} else {
		selectedService.service(options, function(msg) {
			throw new Error(msg);
		});
	}
} catch (e) {
	console.error("ERROR -- " + e.message);
	process.exit(1);
}
